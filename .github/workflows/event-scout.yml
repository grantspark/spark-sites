# Event Scout — Weekly local event discovery
# Runs every Thursday at 8am ET, commits digest to repo.
#
# Required GitHub Secrets:
#   APIFY_API_TOKEN  — from https://console.apify.com/account/integrations
#   GOOGLE_API_KEY   — for Gemini AI scoring

name: Event Scout

on:
  schedule:
    # Every Thursday at 12:00 UTC (8:00 AM ET)
    - cron: "0 12 * * 4"
  workflow_dispatch:
    # Manual trigger — click "Run workflow" in GitHub Actions tab

jobs:
  scout:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repo
        uses: actions/checkout@v4

      - name: Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - name: Install dependencies
        run: pip install -r agents/event-scout/requirements.txt

      - name: Run Event Scout
        env:
          APIFY_API_TOKEN: ${{ secrets.APIFY_API_TOKEN }}
          GOOGLE_API_KEY: ${{ secrets.GOOGLE_API_KEY }}
        run: python agents/event-scout/scout.py

      - name: Commit digest
        run: |
          git config user.name "Event Scout Bot"
          git config user.email "bot@sparkmysite.com"
          git add agents/event-scout/output/
          git diff --cached --quiet || git commit -m "[add] event scout digest $(date +%Y-%m-%d)"
          git push
